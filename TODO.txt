BUGS(uncategorized): {{{

 - tabWidget.Pages().SetCurrentIndex() causes crash sometimes
 - holding scrollbar of textbuffer causes nicklist not to update until you
   release the scrollbar and vice-versa
    - is mw.WindowBase.Synchronize() absolutely necessary for AppendText()?
 - VS_SCROLL hack fires even when textBuffer has keyboard focus
   OR call to SetTextSelection() in AppendText() is doing it
   either way you can't scroll in a super active channel which is the only
   time you really need scroll
 - channelList not populated sometimes
   - 321 ALWAYS comes before 322 
     but if goirc.HandleFunc is just doing go handler() indiscriminately
     which would cause a 322 to get handled before a 321 sometimes at random
     that's another reason to get rid of goirc

     because we *do* want to ignore 322 if the channelList tab was closed atm

     NOTE(tso): unrelated
     userstory storytime:
        " hey what channels are on this network
        " oh shit there are 20,000
        " */list*
        " *server sends 20,000 lines*
        " let's sort by most popular oh this one looks good
        " *closes channel list tab*
        " *client is still receiving 20,000 lines*
        " oh nvm this channel is dead let's see that list again
        " /list

        WHAT SHOULD HAPPEN CHOOSE YOUR ADVENTURE:

        [1] "still getting list results from last time, try again later"
        (what we do now)

        [2] display the still-incoming list results as-is 
        (confusing to user)

        [3] always store all of the list results in a separate array on
            serverState structure instead of relying on channelListModel
            and add a Refresh button to channelList 
            which is disabled until we get ENDOFLIST (323 I assume)
        (A WINNER IS YOU)

        we're basically just recreating xchat at this point

    -tso 7/13/2018 10:27:54 PM

}}}

richedit {{{

FIX PROBLEMS:
 - richedit jumps up like 20 lines or scrolls past the end find out whats
   going on with that it has to do with when its focused or not
   dont just spam WM_VSCROLL although thats probably the solution

 - style bleed is still happening in RichEdit textBuffers
    - now I want to try adding some zero-width characters and
      styling them with AUTOCOLOR (need to test that AUTOCOLOR even does
      anything on visible text)

CREATE NEW PROBLEMS:
 - /search or /find or CTRL+F
    - perfect world: reduce text buffer to matches, then restore
    - real world: jump to selection
 
 - selection automatically goes to clipboard
}}}
---
(*actual todo list) {{{

 - bold/italic/underline toggles don't work
    - colors.go needs a major overhaul 

 - nick with prefix e.g. @channelop should be without prefix in ACTION

 - unicode characters display in a shitty font make sure Universalia is
   used if the text isn't ascii  

 - whitespace or something to indicate where unread messages start

 - CTCP messages should appear somewhere in UI

 - /part without closing tab
     - chanState tracks whether "connected" to channel?

 - split extra long text input
     - maxlen is 450..512
     - ctrl+enter inserts \n
     - split on \n, send multiple lines
     - dialog box: warn about sending > 2 lines

 - don't log lines if DISCONNECTED

 - don't display lines if not sent
    - e.g. cannot send to channel (+m)
 - don't open privmsg tab if not sent
    - e.g. no such nick/channel
}}}
---
walk {{{

PROBLEMS:
 - draw issue when
    1) open /list from #channel
    2) click to channel list tab
    3) click to server tab

    fixes itself when you click on #channel again

    - this also can happen when you /join from a privmsg
      so it probably has to do with how the tabPage being inserted and not
      being shown right away messes with the WM_PAINT or something
      i really don't know

 - nickListBox gets resized back to nonzero when window is resized even
   though the PushButton will hide it again with 1 click maybe something like
   a "hidden" on the nickList and an event on MainWindow

 - we should ReleaseDC() after closing tabs 

EXPLORE A NEW WORLD OF OPPORTUNITY:
 - keyboard nav 
  
 - system tray icon
     - hide to tray
     - notifications balloons for highlight (if !mainWindowFocused)

 - figure out how to make the window flash orange in the task bar

 - enable_caption(0)

 - transparency?
}}}
---
new feature {{{

 - topic widget should allow input and send /topic or whatever
   after: replace topicInput with a RichEdit to display colors and links 

 - highlight list
    - probably should compile regexp for that since its more complex
    - needs dialog, maybe just use TextEdit
    - support for patterns

 - word filter
    - e.g. "fuck" => "****"
    - or 4chan style "fam" => "desu"

 - limit scrollback to n lines

 - load chatlog on join
}}}
---
big project/refactor {{{

 - new server tab/connection abstraction

 - make empty server tab possible
}}}
---
commands {{{

 - usage text and descriptions for all commands in a map.

 - /mode needs to be able to send just the channel e.g. MODE #test
   to get a reply of what the mode is
   expected: /mode #channel
             Mode for #channel is +CSnpstz
             /mode tso
             tso (221: +Sirx)

 - ditto for /topic
   expected: /topic
             Topic for #channel is "words" set by tso at 7/12/2018 11:54:18 PM

 - /welcome
    - first run welcome message
    - ascii art logo
    - contact + link to github
    - getting started
      /server irc.example.org +
      /join #channel
      hi
    - /help for more information

 - tab completion for commands

need dialog box for better management of lists:
 - /ignore
    - /unignore
 - /invite
    - /uninvite
 - /kickban

easy:
 - /whois
 - /version
 - /away
 - /unaway
}}}
---
improvements {{{

 - better scripting examples
    - useful/common things: rainbow text, automatic translation, emoticons
}}}
---
config {{{

 - autoload registered scripts at startup

 - settings dialog
 
 - write to config.json
     - save current state as autojoin on exit (optional)

 - automatic NickServ stuff

 - hidejoinparts per channel(with list) or global

 - ignore list

 - highlight list
    - disable highlight
}}}
---
dcc {{{

 - /send 

 - file transfers tab
 
 - Save As dialog on recv

 unrelated: maybe turn tsobot into a XDCC bot
}}}
---
extensions {{{

 - inline twitter links
}}}
---
bikeshedding {{{

 - testing
     - it would be nice if we could test the UI 
       without having to connect to a network 
         - one of each type of tab opens up 
         - each with examples of every type of information it can display in
           all states
         - just for the sake of designing
         - doesn't have any logic
         - separate application
         - would probably have to split project into subpackages (yuck)
           - no wait we could do what we did when testing richedit
             // +build ignore
             
             go build testapp.go *:not(main) # wait this isn't css

     - it would be nice if we could test the logic by faking a connection e.g.
       by sending raw IRC lines e.g.
       ":host@nowhere PRIVMSG #fakechannelfortesting :test\n"
       on a simple channel or something so there's nothing complicated about
       mocking a connection if only it were that easy

 - replace goirc with simple channels and goroutines
    yay:
         - /reconnect is impossible for some reason
         - logger interface is inconvenient
         - no convenient way to capture unhandled server messages 
         - it would be trivial to mock connections by just sending raw IRC
           lines on the recv chan

           in fact I'll add it to the irc subpackage right now.

    nay:
         - it works
         - has anti-flooding stuff
         - line parsing might be harder than it looks

 - replace walk with qt 
    ... for version 2.0

    yay:
         - inline images for emojis and embedding thumbnails 
         - richedit is hella annoying

    nay:
        - walk is hella comfy
        
 - irc bouncer (separate project)
     - use public/private key pairs for authentication or something
     - basically just a relay/proxy that PING/PONGs when the user isn't connected
     - stores messages while user isn't connected, dumps (user configurable
       amount) on reconnect
     - autoreply or maybe just (Away)!
     - *** this sort of thing might be against IRC network rules need to look into
       what the policy is and/or how znc does it so well
       or just use znc

}}}
---
colors {{{

 - write more test cases

 - strip control codes from other parts of the ui (like channel list)

 - SEND COLORS
    - shorthand `red:no u`
    - ctrl+k inserts \x03
    - ctrl+b inserts \x02
    - etc...
    - NOTE(tso): you can already send control codes with scripting

 - unique random colors for nicks

 - themes
}}}
---
tabwidget {{{

 - mouse
     - middle-click to close tabs
     - scroll to cycle through tabs
     - context menu
        - mark as read
        - close
BETTER CONTEXT MENU IDEA OMG
 - list
   of
   current
   networks
   and 
   channels (and privmsgs)
   !!

 - keyboard
    - ctrl+t for empty server tab
    - ctrl+tab to 
        
 - windows styles
     - multiline
     - stretch-to-fit
     - button style

 - automatic tab sort order 
    - alphabetical
    - most activity
}}}

░░░

RESOURCES: {{{

IRC:
http://modern.ircdocs.horse/

About Tab Controls | Microsoft Docs
https://docs.microsoft.com/en-us/windows/desktop/Controls/tab-controls#tc_image_lists

Windows #define stuff:
https://doc.pcsoft.fr/en-US/?6510001
https://docs.microsoft.com/en-us/windows/desktop/WinProg/windows-data-types

RichEdit stuff:
https://docs.microsoft.com/en-us/windows/desktop/Controls/bumper-rich-edit-rich-edit-control-reference
https://docs.microsoft.com/en-us/windows/desktop/api/Richedit/ns-richedit-tagrichedit_image_parameters
https://docs.microsoft.com/en-us/windows/desktop/api/Richedit/ns-richedit-_charformat
https://github.com/Microsoft/Windows-classic-samples/blob/master/Samples/DynamicDPI/cpp/SampleRichEditControl.cpp
https://docs.microsoft.com/en-us/windows/desktop/Controls/em-geteditstyle
https://docs.microsoft.com/en-us/windows/desktop/Controls/em-seteventmask
https://docs.microsoft.com/en-us/windows/desktop/Controls/rich-edit-control-event-mask-flags
https://docs.microsoft.com/en-us/windows/desktop/Controls/em-geteditstyleex
https://github.com/Alexpux/mingw-w64/blob/master/mingw-w64-headers/include/richedit.h

Useful:
    open urls from command line in any OS:
https://www.dwheeler.com/essays/open-files-urls.html

    get tab key messages in windows:
http://forums.codeguru.com/showthread.php?60142-How-to-trap-WM_KILLFOCUS-with-Tab-key

}}}

▒▒▒

ADDENDUM: {{{

RE: inserting images in RichEdit

nvm OLE is exceptionally awful and I can't figure out how to get the
OBJECTPOSITIONS messages so fuck it if we want more out of the UI than pretty
colors there's always walk.WebView, electron, Qt, or reinventing the wheel
(render text and handle pointer events for text selection and put stuff on the
clipboard manually and invent a scrollbar and waste like a solid year on that)

-tso, July Sun Jul 8 07:49:26 2018 -0400
}}}






# vim: tw=70 ft=help fdm=marker fmr={{{,}}} fdl=0 fen:
